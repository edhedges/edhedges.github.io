<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/component---src-templates-blog-template-js.6c0ff3d990ae567f46de.css">@import url(https://fonts.googleapis.com/css?family=Nunito:700);html{font-family:Nunito,Verdana,sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a,a:visited{color:#f2864a;background-color:transparent;-webkit-text-decoration-skip:objects;text-decoration:none}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:#273640;font-weight:400;font-size:18px;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}.header_h1,.social_list{text-align:center}.social_list{display:inline-block;list-style-type:none;height:35px;width:50%;margin:10px auto;padding:5px 0 0}.social_list li{display:inline;margin:0 8px;padding:0}.social_list li a i{font-size:28px}.arsenal_list li{display:inline;margin:0 3px}@media only screen and (max-width:500px){.header_h1,.social_list{display:block!important;margin:10px auto 0;text-align:center;width:100%!important}}</style><meta name="generator" content="Gatsby 2.0.76"/><title data-react-helmet="true">Pi-hole Adventures | Eddie Hedges</title><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Nunito:300,400,700" rel="stylesheet"/><link data-react-helmet="true" rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous"/><meta data-react-helmet="true" name="description" content="Eddie Hedges is a software developer that enjoys both front and back end development. This includes markup, styling, user interface, functionality, and data store. This website will have information about programming, web development and design, .NET, python, javascript, typescript, html, css, sass, open source, and possibly some health/nutrition information."/><meta data-react-helmet="true" property="og:title" content="Pi-hole Adventures"/><meta data-react-helmet="true" property="og:description" content="Eddie Hedges is a software developer that enjoys both front and back end development. This includes markup, styling, user interface, functionality, and data store. This website will have information about programming, web development and design, .NET, python, javascript, typescript, html, css, sass, open source, and possibly some health/nutrition information."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Eddie Hedges"/><meta data-react-helmet="true" name="twitter:title" content="Pi-hole Adventures"/><meta data-react-helmet="true" name="twitter:description" content="Eddie Hedges is a software developer that enjoys both front and back end development. This includes markup, styling, user interface, functionality, and data store. This website will have information about programming, web development and design, .NET, python, javascript, typescript, html, css, sass, open source, and possibly some health/nutrition information."/><meta data-react-helmet="true" name="keywords" content="Raspberry Pi, Pi-hole, Linux, Raspbian, Ad blocking, Networking, DNS, VPN"/><link rel="shortcut icon" href="/icons/icon-48x48.png"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="shortcut icon" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/favicon-32x32.png"/><link rel="manifest" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/manifest.json"/><meta name="mobile-web-app-capable" content="yes"/><meta name="theme-color" content="#fff"/><meta name="application-name" content="eddie-hedges-website"/><link rel="apple-touch-icon" sizes="57x57" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/apple-touch-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/apple-touch-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/apple-touch-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/apple-touch-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/apple-touch-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/apple-touch-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/apple-touch-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/apple-touch-icon-152x152.png"/><link rel="apple-touch-icon" sizes="167x167" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/apple-touch-icon-167x167.png"/><link rel="apple-touch-icon" sizes="180x180" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/apple-touch-icon-180x180.png"/><link rel="apple-touch-icon" sizes="1024x1024" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/apple-touch-icon-1024x1024.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/><meta name="apple-mobile-web-app-title" content="eddie-hedges-website"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 1)" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/apple-touch-startup-image-320x460.png"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/apple-touch-startup-image-640x920.png"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/apple-touch-startup-image-640x1096.png"/><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/apple-touch-startup-image-750x1294.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 3)" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/apple-touch-startup-image-1182x2208.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 3)" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/apple-touch-startup-image-1242x2148.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 1)" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/apple-touch-startup-image-748x1024.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 1)" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/apple-touch-startup-image-768x1004.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/apple-touch-startup-image-1496x2048.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)" href="/icons-eb0722bf01baeb8b8bdace82de47f4c4/apple-touch-startup-image-1536x2008.png"/><link as="script" rel="preload" href="/component---src-templates-blog-template-js-71f69add7afe55131037.js"/><link as="script" rel="preload" href="/0-2f400aa047851a1d731d.js"/><link as="script" rel="preload" href="/app-a43a08b934c1abf031b3.js"/><link as="script" rel="preload" href="/webpack-runtime-d4ba4bf086904002fceb.js"/><link as="fetch" rel="preload" href="/static/d/243/path---blog-2019-01-29-pi-hole-adventures-663-18d-g4clF8pNzWfzaOCKXmMexnXbFrc.json" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div style="background:#fff"><div style="margin:0 auto;max-width:960px;padding:1rem 1.0875rem"><h1 class="header_h1" style="display:inline-block;margin:0;width:50%"><a style="color:#2E404C;text-decoration:none" href="/">Eddie Hedges</a></h1><ul class="social_list"><li><a href="https://github.com/edhedges"><i class="fab fa-github"></i></a></li><li><a href="https://stackoverflow.com/users/1165441/edhedges"><i class="fab fa-stack-overflow"></i></a></li><li><a href="https://www.linkedin.com/in/eddiehedges"><i class="fab fa-linkedin-in"></i></a></li></ul><br/><hr/></div></div><div style="margin:0 auto;max-width:960px;padding:0px 1.0875rem 1.45rem;padding-top:0"><div><div><div style="padding:0 0 2rem 0">Want to read more posts? Go back to the <a href="/blog">archives</a>.</div></div><div class="blog-post-container"><div class="blog-post"><h1>Pi-hole Adventures</h1><h2>January 29, 2019</h2><div class="blog-post-content"><h3>What's a Pi-hole?</h3>
<p><a href="https://pi-hole.net/">Pi-hole</a> is a black hole for internet advertisements and a network wide ad blocker. These simple descriptions don't do this open source project justice and that's the motivation of this post. I'm going to dive into how I'm using a Raspberry Pi Model B+ 512MB Ram running pi-hole to do the following:</p>
<ul>
<li>Block ads at the network level</li>
<li>Be a recursive DNS server</li>
<li>Expose an OpenVPN server in order to receive the aforementioned features while on the go</li>
</ul>
<h3>Basic Pi-hole Installation</h3>
<p>The first thing I did was ensure my Raspberry Pi Model B+ met the Pi-holes <a href="https://docs.pi-hole.net/main/prerequesites/">prerequisites</a>. I then used <a href="https://www.balena.io/etcher/">balenaEtcher</a> to flash a fresh image of <a href="https://www.raspberrypi.org/downloads/raspbian/">Raspbian Stretch Lite</a> onto an 8GB Micro SD. Unfortunately, I forgot to setup <a href="https://www.raspberrypi.org/documentation/remote-access/ssh/">ssh access</a> before flashing it so I had to do it after the fact. Doing it before saves you from having to attach a display and keyboard to interact with it. Next, I logged in to my pi via the default credentials of <code>pi</code> / <code>raspberry</code>. I made sure my package repository and my installed packages were up to date by running the following command: <code>sudo apt-get update -y &#x26;&#x26; sudo apt-get dist-upgrade -y</code>. Finally, I ran the pi-hole installer command: <code>curl -sSL https://install.pi-hole.net | bash</code>.</p>
<p>Before ads can be blocked there's a <a href="https://docs.pi-hole.net/main/post-install/">post install step</a> that must be taken in order to start blocking ads. The gist is that Pi-hole can't block requests if there's none coming through it. The solution is to instruct the router to send its requests through the Pi-hole. I have an ASUS RT-N66U and followed <a href="https://discourse.pi-hole.net/t/how-do-i-configure-my-devices-to-use-pi-hole-as-their-dns-server/245">these directions</a> to set my routers LAN DNS to point to the Pi-hole. I may be changing my setup to have the Pi-hole act as the DHCP server as well since it seems like this might be the most effective / authoritative way to ensure clients don't force queries around the Pi-hole.</p>
<p>I found it eye-opening and frankly shocking how many requests were being blocked. The <a href="https://github.com/pi-hole/AdminLTE">Pi-hole dashboard</a>, which can be accessed via <a href="http://pi.hole">http://pi.hole</a> or <a href="http://IP-OF-PI-HOLE">http://IP-OF-PI-HOLE</a> is easy to use and provides immediate value for those interested in what's happening on the network.</p>
<h3>Recursive DNS</h3>
<p>As I mentioned before, I found this whole Pi-hole community and experience addicting. I wanted to learn more about what wass possible in terms of securing my home network and preventing unwanted advertising / tracking from reaching my loved ones and myself. In my research I learned I could have the Pi-hole be a recursive DNS. This was one step closer to becoming more self-reliant and not have to trust as many third party services I know nothing about. I read <a href="https://docs.pi-hole.net/guides/unbound/">this guide</a> and educated myself on the what and why of setting up the recursive DNS server, but if you're convinced and just want to get it done <a href="https://docs.pi-hole.net/guides/unbound/#setting-up-pi-hole-as-a-recursive-dns-server-solution">go here</a>.</p>
<h3>ASUS, you're breaking my heart</h3>
<p>I noticed that some of my requests were not being resolved by my Pi-hole. I did a little tinkering and ended up changing my routers WAN DNS to point to only my Pi-hole. <em>Disclosure: I barely know what I'm doing</em>, but I ended up noticing that the router was <strong>making requests every 5 seconds</strong> to <code>dns.msftncsi.com</code>. I'm not sure what these requests were, but I found this helpful <a href="https://discourse.pi-hole.net/t/excessive-requests-for-dns-msftncsi-com/556">discourse thread</a> that shed a bit of light. The solution involves using <code>telnet</code> to access your router and use <code>nvram</code> to set <code>dns_probe_content</code> to <code>0.0.0.0</code> and <code>dns_probe_host</code> to <code>""</code>. Here's a <a href="https://discourse.pi-hole.net/t/excessive-requests-for-dns-msftncsi-com/556/6">direct link</a> to the solution that worked for me. Now my chattiest client is my Roku, but I've yet to find any solution that doesn't involve unplugging it...</p>
<h3>Pi-hole on the go</h3>
<p>Even after a week, I still had a real sense of pleasure from the fact that I was able to use the internet from any device in my home with minimal (if any) advertising and tracking. I realized to my horror that as soon as I wasn't on my network I would lose all of these benefits. I did a little more reading and implemented a solution that uses <a href="https://openvpn.net/">OpenVPN</a>, <a href="https://www.dynu.com/">Dynu DDNS</a>, and <a href="https://passepartoutvpn.app/">Passepartout</a> to allow my iPhone XS to tunnel back into my home network immediately upon losing my wireless router's connection!</p>
<p><em>Security Note: Make sure to secure your network and your Pi-hole device specifically when exposing it to inbound connections from the internet.</em></p>
<p>I initially tried this with the official OpenVPN client application for iOS, but frankly it was garbage and required a lot of manual intervention to ensure I was connected. Passepartout has a nice feature that allows setting "trusted networks" and will disconnect from the VPN upon connecting to those trusted networks and vice-versa. The <a href="https://docs.pi-hole.net/guides/vpn/overview/">guide I followed</a> to accomplish this is a great starting point and I won't repeat it as it's very thorough. I will say this was a challenge and required a bit of google + trial and error. This <a href="https://discourse.pi-hole.net/t/see-my-pihole-enabled-openvpn-server/111/3">discourse comment</a> was particularly helpful when I ran into a snafu.</p>
<p>There are a couple things that aren't covered in the above guide that I needed to do for my setup to work. The first was to use Dynu DDNS to give my Pi-hole a "static domain" that effectively just forwards traffic to the Pi-holes public facing IP address. I used <a href="https://www.dynu.com/DynamicDNS/IPUpdateClient/RaspberryPi-Dynamic-DNS">this guide</a> to setup a cron job on my Pi-hole that tells my Dynu DDNS domain what the public IP address is dynamically. The second was configuring my router to forward the VPN client port to the internal port the OpenVPN server runs on.</p>
<h3>You're still here?</h3>
<p>If you made it this far you probably spend too much time on your computer, but I appreciate you reading the post! Feel free to reach out with any comments / questions about my Pi-hole setup.</p></div></div></div></div><br/><br/><hr/><footer style="text-align:center">© <!-- -->2020<!-- -->, Built by Eddie Hedges with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a> <!-- -->and hosted on <a href="https://pages.github.com/">GitHub Pages</a></footer></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-template-js","jsonName":"blog-2019-01-29-pi-hole-adventures-663","path":"/blog/2019/01/29/pi-hole-adventures"};window.dataPath="243/path---blog-2019-01-29-pi-hole-adventures-663-18d-g4clF8pNzWfzaOCKXmMexnXbFrc";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-a43a08b934c1abf031b3.js"],"component---src-templates-blog-template-js":["/component---src-templates-blog-template-js.6c0ff3d990ae567f46de.css","/component---src-templates-blog-template-js-71f69add7afe55131037.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx.6c0ff3d990ae567f46de.css","/component---src-pages-404-tsx-08aa60f4502a8d26d4fd.js"],"component---src-pages-blog-tsx":["/component---src-pages-blog-tsx.6c0ff3d990ae567f46de.css","/component---src-pages-blog-tsx-ccd9b93a6be67107ade3.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx.88e6fb5e1e9d82d5397c.css","/component---src-pages-index-tsx-e5a521d1fb54d5560b44.js"],"pages-manifest":["/pages-manifest-f99448635bd3fa8bc45a.js"]};/*]]>*/</script><script src="/webpack-runtime-d4ba4bf086904002fceb.js" async=""></script><script src="/app-a43a08b934c1abf031b3.js" async=""></script><script src="/0-2f400aa047851a1d731d.js" async=""></script><script src="/component---src-templates-blog-template-js-71f69add7afe55131037.js" async=""></script></body></html>